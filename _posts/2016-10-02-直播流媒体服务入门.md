---
layout: post
title: 流媒体服务入门
tags:
- 流媒体
categories: 流媒体服务
description: 一个搜集流媒体信息的大杂烩。
---

# 直播流媒体服务入门
##prologue
在查看本文之前，请确认您已经读取了雷霄骅的入门博客中的以下文章，注意，有先后次序。

[视音频数据处理入门：RGB、YUV像素数据处理](http://blog.csdn.net/leixiaohua1020/article/details/50534150)

[视音频数据处理入门：H.264视频码流解析](http://blog.csdn.net/leixiaohua1020/article/details/50534369)

[视音频数据处理入门：FLV封装格式解析](http://blog.csdn.net/leixiaohua1020/article/details/50535082)



以上博客文章为解释某个格式的入门教程，必须通读。其中若对FLV封装格式有理解不透的地方可以**先搁置**，对H264的核心理解不透也可先放着，但是必须懂得I,P,B帧的基本区别与最简单的判断方法。

##rtmp
目前市面上市场占有率最大的直播流媒体传输协议是rtmp。对rtmp陌生的同学可以先查看雷神的另外一篇博客
[总结\]RTMP流媒体技术零基础学习方法](http://blog.csdn.net/leixiaohua1020/article/details/15814587)
博客简单介绍了rtmp的用途，应用场景和最简单的使用方法。虽然文章有点老旧，里面大多介绍的技术目前已经不用，不过可以作为入门文章查看。
##流程综述
最简流媒体服务流程如下图所示：

![img](http://dl2.iteye.com/upload/attachment/0101/6229/7da220c4-0b1f-3bed-b30b-024a8968fd7f.jpg)
输入源经过**推流器**，在这里使用ffmpeg，推到位于云端的服务器**流媒体服务器**，在这里使用nginx-rtmp-module，再由**收流器**，在这里使用普通的网页进行观看。接下来将简单介绍三个部分的最简实现。

##目前主流的流媒体服务器的入门级别介绍
如果你已经仔细阅读了雷神博客中介绍rtmp的文章后，大致可了解其文章中推荐的两款流媒体服务器fms和red5。不过很遗憾的跟大家说，fms和red5目前已经**不是主流流媒体服务器**了！。流媒体服务器由于其特殊性基本每年都有新的思想推出，每年的霸主基本都有变化，在这里只能介绍目前来说比较稳定市场占有率的两款主流流媒体服务器。

很遗憾的是，我介绍的流媒体服务器都不能完全支持windows，故在搭建开始前必须至少搭建一个靠谱的linux虚拟机或实体机。

###nginx-rtmp-module
nginx-rtmp-module是战斗民族俄罗斯人民开发的一款**NGINX的流媒体插件**，在继承了其母体nginx的高并发与事件处理机制外，具备了流媒体服务器的几乎所有常见功能，比如
```
推拉流媒体资源

基于HTTP的FLV/MP4 VOD点播

HLS (HTTP Live Streaming) M3U8的支持

基于http的操作（发布、播放、录制）

可以很好的协同现有的流媒体服务器以及播放器一起工作

在线调用ffmpeg对流媒体进行转码

H264/AAC音视频编码格式的支持

linux/BSD/MAC系统的支持

```
这个流媒体服务器可以支持RTMP和HLS(Live Http Stream)。



编译方式非常简单，可参考colority的博客内容：

[nginx 搭建rtmp流媒体服务器流程笔记](http://blog.csdn.net/coloriy/article/details/51427041)



###srs
srs是国人写的一个推翻nginx-rtmp-module的流媒体服务器，全称simple-rtmp-server。该服务器功能与nginx-rtmp-module几乎相同，但是在核心技术中srs使用了**协程**概念，效率提升了60%。
srs目前已经闭源，不过可以在我的github中下载到:

[srs](https://github.com/godka/srs)

编译方式在页面中的readme.md中，配置很方便。

##前端推流器的入门级别介绍
目前基于rtmp的流媒体直播系统最大的难点就在推流器了。推流器制作的好坏直接影响了直播中画面的质量，而网络的延时质量则是cdn解决的问题。
前端推流器目前介绍一个最简单的ffmpeg。根据ffmpeg.org主页上的介绍，ffmpeg is 
```
A complete, cross-platform solution to record, convert and stream audio and video.
```
ffmpeg的编译方式与使用方式相对来说很困难，参考以下这篇博文：

[linux安装编译配置ffmpeg](https://my.oschina.net/zhangjie830621/blog/469909)

**在此注意，ffmpeg本身并不自带h264的编码功能，故需要自己安装libx264，该方法有很多种，建议自己百度学习提高简单的linux编译水平**

安装完ffmpeg之后，通过以下指令就能简单将某个流推送到流媒体服务器上。关于其每个参数的意义目前不说，等各位基础打扎实了之后再一一讲解
```
ffmpeg -re -i 输入视频流.mp4 -vcodec libx264 -faac -strict -2 rtmp://你的rtmp服务器位置/你的rtmp地址/你的rtmp房间号
```

##前端拉流器的入门级别介绍
所谓的拉流器，就是**rtmp播放器**。视频实时推送到了流媒体服务器之后，总该想个招从服务器里将数据拉下查看吧。拉流器分很多种，基于PC端和基于网页端的。目前各位不需要去关心PC端的制作过程，更不用关心网页端的核心制作过程，只需要拿来用就行了。
关于网页端的介绍可以参考雷神的博客

[总结\]RTMP流媒体技术零基础学习方法](http://blog.csdn.net/leixiaohua1020/article/details/15814587)

该文章最后一部分简单介绍了几款容易配置的拉流器，各位可以先拿他们来练练手。

##直播流媒体中的CDN
这章内容浅尝辄止了解就好。
直播流媒体中的CDN技术与传统的CDN完全是反的。传统的CDN是由中央向四周传播，而流媒体的CDN是由临近节点向中央传播。举个例子：只要将流推向集群中的任意一台SRS（不管是源还是edge），都能从集群中的任意一台SRS（不管是源还是edge）将视频流拉取下来。
如果有多个源，edge只把流推向其中的一个。一旦正在使用的源死掉，边界将会自动寻找配置中指定的其他源，中断时间极短，也算是高可用的一种形式。
目前观止（srs的母公司）推出的srs-edge解决方案是一个很优秀的集群解决方案。

##整体演示
我将在周五的报告会中进行简单的综合演示。